@model IEnumerable<AI_Task_Planner.Models.TaskTimeLog>

@{
    ViewData["Title"] = "Time Logs";
}

<div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Time Logs: @ViewBag.TaskTitle</h4>        <div>
            <a asp-controller="TaskTime" asp-action="StartTimer" asp-route-taskId="@ViewBag.TaskId" asp-route-returnUrl="@Context.Request.Path" class="btn btn-success">
                <i class="fas fa-play"></i> Start Timer
            </a>
            <a asp-controller="TaskTime" asp-action="StopTimer" asp-route-taskId="@ViewBag.TaskId" asp-route-returnUrl="@Context.Request.Path" class="btn btn-danger">
                <i class="fas fa-stop"></i> Stop Timer
            </a>
            <a asp-controller="TaskTime" asp-action="PauseTimer" asp-route-taskId="@ViewBag.TaskId" asp-route-returnUrl="@Context.Request.Path" class="btn btn-warning">
                <i class="fas fa-pause"></i> Pause
            </a>
            <a asp-controller="TaskTime" asp-action="ResumeTimer" asp-route-taskId="@ViewBag.TaskId" asp-route-returnUrl="@Context.Request.Path" class="btn btn-info">
                <i class="fas fa-play-circle"></i> Resume
            </a>            <a asp-controller="TaskTime" asp-action="Create" asp-route-taskId="@ViewBag.TaskId" class="btn btn-light">
                <i class="fas fa-plus"></i> Add Manually
            </a>
        </div>
    </div>
    <div class="card-body">
        @if (Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Duration</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {                            <tr class="@(item.EndTime.HasValue ? "" : item.IsPaused ? "table-info" : "table-warning")">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-user-circle fa-2x me-2 text-muted"></i>
                                        @item.User.UserName
                                    </div>
                                </td>
                                <td>@item.StartTime.ToString("MMM d, yyyy h:mm tt")</td>
                                <td>
                                    @if (item.EndTime.HasValue)
                                    {
                                        @item.EndTime.Value.ToString("MMM d, yyyy h:mm tt")
                                    }
                                    else if (item.IsPaused)
                                    {
                                        <span class="badge bg-info text-dark">Paused</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning text-dark">In progress</span>
                                    }
                                </td>
                                <td>
                                    @if (item.DurationMinutes < 60)
                                    {
                                        <span>@item.DurationMinutes min</span>
                                    }
                                    else
                                    {
                                        <span>@(item.DurationMinutes / 60)h @(item.DurationMinutes % 60)m</span>
                                    }
                                </td>
                                <td>@item.Description</td>
                                <td>
                                    <div class="btn-group">
                                        <a asp-action="Edit" asp-route-id="@item.LogId" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.LogId" class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mt-4">
                <div class="card bg-light">
                    <div class="card-body">
                        <h5 class="card-title">Summary</h5>
                        @{
                            var totalMinutes = Model.Where(l => l.EndTime.HasValue).Sum(l => l.DurationMinutes);
                            var hours = totalMinutes / 60;
                            var minutes = totalMinutes % 60;
                        }
                        <p class="card-text">Total time spent: <strong>@hours hours and @minutes minutes</strong></p>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <div class="mb-3">
                    <i class="fas fa-hourglass-start fa-4x text-muted"></i>
                </div>
                <h4>No time logs recorded yet</h4>
                <p class="text-muted">Start tracking time for this task by clicking the "Start Timer" button</p>
            </div>
        }
    </div>
    <div class="card-footer">
        <a asp-controller="Tasks" asp-action="Details" asp-route-id="@ViewBag.TaskId" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to Task
        </a>
    </div>
</div>
